'use strict';

var _require = require('../'),
    encode = _require.encode,
    decode = _require.decode;

var from = new Date('2017-10-10').valueOf();
var to = new Date('2017-10-20').valueOf();

test('Correctly encodes an object', function () {
  var res = encode({
    from: from,
    to: to,
    source: 'TWITTER',
    sentiment: { or: ['POSITIVE'] }
  });

  expect(res).toMatchSnapshot();
});

test('Correectly decodes a string', function () {
  // Taked from the snapshot of the above test.
  var encoded = '!0n1507593600000!1n1508457600000!2s0!9o0POSITIVE';

  var filters = decode(encoded);

  expect(filters.from).toEqual(from);
  expect(filters.to).toEqual(to);
  expect(filters.source).toEqual('TWITTER');
  expect(filters.sentiment).toMatchObject({
    or: ['POSITIVE']
  });
});

test('Correctly encodes and decodes a complex object', function () {
  var obj = {
    from: from,
    to: to,
    source: 'TWITTER',
    sentiment: { or: ['POSITIVE', 'NEGATIVE'], not: ['UNKNOWN'] },
    category: { and: ['cat1', 'cat2'], not: ['cat6'] },
    mainMessage: true
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);

  expect(filters).toMatchObject(obj);
});

test('Correctly encodes and decodes a complex object 2', function () {
  var obj = {
    "from": 1505080800000,
    "to": 1507759199999,
    "view": "5899c2bd3fa1bd22ae7b7d06",
    "product": "581723b376e4b5a0637c6b13",
    "category": {
      "or": ["52de42d430044041a8344548", "52de42ca30044041a83444df", "52de42cc30044041a83444ef", "52de42ce30044041a8344510", "52de42d730044041a8344568"]
    }
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);

  expect(filters).toMatchObject(obj);
});

test('Correctly encodes match filter', function () {
  var obj = {
    "from": 1505080800000,
    "to": 1507759199999,
    "view": "5899c2bd3fa1bd22ae7b7d06",
    "text": {
      "match": "something"
    }
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);

  expect(filters).toMatchObject(obj);
});

test('Handles undefined values', function () {
  var obj = {
    "from": 1505080800000,
    "to": 1507759199999,
    "view": undefined
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);
  expect(filters).toMatchObject({
    from: obj.from,
    to: obj.to
  });
});

test('This motherfucker', function () {
  expect(function () {
    return decode('!0n1505599200000!1n1508277599999!2s0!3m');
  }).not.toThrow();
});

test('This other motherfucker', function () {
  expect(function () {
    return decode('!0n1506808800000!1n1509490799999!2s4!3m599bfd1396474d000f16a580!13o0digitalización~0#itblogs~0negocio~0bonificación~0comercio~0directivo~0economía~0#weloveyougilinsky~0#ecommerce~0#digitalización~0#observatoriovodafone');
  }).not.toThrow();
});

test('Supports the followers filter', function () {
  var obj = {
    followers: {
      min: 1000,
      max: 100000
    }
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);
  expect(filters).toMatchObject({
    followers: {
      min: 1000,
      max: 100000
    }
  });
});

test('Correctly encodes a %', function () {
  var obj = {
    text: {
      or: ['some%', '%'],
      match: '%wow'
    }
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);
  expect(filters).toMatchObject({
    text: {
      or: ['some%', '%'],
      match: '%wow'
    }
  });
});

test('Correctly encodes a space', function () {
  var obj = {
    text: {
      or: ['#hashtag', 'some more']
    }
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);
  expect(filters).toMatchObject({
    text: {
      or: ['#hashtag', 'some more']
    }
  });
});

test('Correctly encodes a {', function () {
  var obj = {
    text: {
      or: ['{']
    }
  };

  var encoded = encode(obj);

  expect(encoded).toMatchSnapshot();

  var filters = decode(encoded);
  expect(filters).toMatchObject({
    text: {
      or: ['{']
    }
  });
});